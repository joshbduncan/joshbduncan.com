<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="description" content="design. maker. fun haver." />
  <title>joshd.xyz</title>
  <link rel="stylesheet" type="text/css" href="/static/styles.css" />
  <link rel="stylesheet" type="text/css" href="/static/codehilite.css" />
  <link rel="shortcut icon" href="/static/favicon.ico" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-200586146-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-200586146-2");
  </script>
  <!-- OPEN GRAPH, FACEBOOK, TWITTER META TAGS -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="joshd.xyz" />
  <meta property="og:url" content="https://joshd.xyz/checking-linked-records-in-airtable.html" />
  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Checking off Linked Records in an Airtable Script" />
  <meta property="og:description" content="I needed a quick way to check off a bunch of linked records in Airtable so I worked up this little script to do it from an Airtable button." />
  
  <meta property="og:image" content="https://joshd.xyz/static/images/jbd-card.png" />
  <meta name="twitter:site" content="@joshbduncan" />
  <meta name="twitter:creator" content="@joshbduncan" />
</head>

<body>
  <header>
    <input id="toggle" type="checkbox" autocomplete="off" />
    <label for="toggle" id="hamburger">
      <div id="top-bun"></div>
      <div id="meat"></div>
      <div id="bottom-bun"></div>
    </label>
    <nav>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/categories.html">Categories</a></li>
        <li><a href="/tags.html">Tags</a></li>
        <li><a href="/search.html">Search</a></li>
        <li><a href="/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <logo>
      <a href="/" title="Home">
        <img src="/static/images/jbd_avatar_pixel_head.svg" alt="joshd.xyz" width="72" height="72"
             onmouseover="wink(this, 1)" onmouseout="wink(this, 0)" />
      </a>
    </logo>
  </header>

  <section>
    <div class="container">
      <!-- FLASK BLOCK CONTENT -->
      
<article>
  <h1>Checking off Linked Records in an Airtable Script</h1>
  <div id="post-meta">
    By Josh Duncan â€¢
    
    <b>Published</b> August 2021 â€¢
    <a href="/category/development.html"><b>development</b></a>
  </div>
  <div id="post-body">
    <p>A few years back I built a custom job tracker in <a href="https://www.airtable.com/">Airtable</a> that helps me keep up with all of my freelance projects. The base is pretty simple and only consists of three tables, "Jobs", "Clients", and "Contacts". As you would expect, each "Job" has a "Client", which in-turn has a "Contact" (some of my clients have multiple contacts).</p>
<h2>Backstory</h2>
<p>Previously, I tracked overall time for each project in a "duration" field that I would manually update every time I did any work. And, up until recently non of my time-tracked projects lasted more than week so this method worked just fine... Well, until last month.</p>
<p>See, I bill my clients monthly and some their projects started spanning more than one month, making it hard to determine what I time had already billed when the next month comes around.</p>
<p>To fix this, I created a new table titled "Time Entries" which links back to individual jobs. Every time I work on a project now, I create a new time entry with the date and time that I worked. Each time entry also has a "checkbox" field titled "Invoiced". Now, when the end of the month comes, I can just bill for the time entries that are not checked as "Invoiced".</p>
<h2>The Problem</h2>
<p>This new method works well, but I got annoyed today when I had to click off sixty-four linked time entries for one client. I do my invoicing from a custom view in the "Jobs" table so this process takes way too long... You have to click the linked record, scroll down and click the "Invoiced" checkbox, then click out of the linked record pop-up.</p>
<p>I know I could create a filtered view in the "Time Entries" table that's grouped by customer but that's not ideal for me.</p>
<h2>The Solution</h2>
<p>I've recently been learning some Javascript and knew Airtable had scripting capabilities so I figured I could whip up something to help me out.</p>
<p>Before I started scripting I switched to my custom "Invoicing" view in the "Jobs" table that I mentioned above. This view only shows jobs with "uninvoiced" time entries and has all records grouped by client so things are easier to see.</p>
<p>To this view, I added a new <a href="https://support.airtable.com/hc/en-us/articles/360048496693-Button-field">button field</a> that will run my script on the current record when clicked.</p>
<h2>Time to Script</h2>
<p>Before I start scripting I like to make a list of everything I'm trying to accomplish. This time the list is short but I find it helps me stay on track...</p>
<p><strong>Scripting Steps:</strong></p>
<ol>
<li>Get all time entries for a particular job</li>
<li>Loop through all matching time entries</li>
<li>Check to make sure the time entry hasn't been invoiced</li>
<li>Mark it as invoiced</li>
</ol>
<p>If you are new to Airtable Scripting like me, here's their <a href="https://www.airtable.com/developers/scripting/api">Scripting Documentation</a> for reference.</p>
<h3>Getting Setup</h3>
<p>First I'll need to get the two tables I'm working with as objects so that I can reference and query them. And, I'll also go ahead and query all of the time entries so I can update the "uninvoiced" ones that match the job I'm invoicing.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span> <span class="nx">jobsTable</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">getTable</span><span class="p">(</span><span class="s2">&quot;Jobs&quot;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">timeEntriesTable</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">getTable</span><span class="p">(</span><span class="s2">&quot;Time Entries&quot;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">timeEntriesQuery</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">timeEntriesTable</span><span class="p">.</span><span class="nx">selectRecordsAsync</span><span class="p">();</span>
</code></pre></div>

<p>I'll be running this script via a button like I mentioned above, but it can also be ran right from the scripting menu so I need to have a way to choose a record in that case.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span> <span class="nx">record</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">input</span><span class="p">.</span><span class="nx">recordAsync</span><span class="p">(</span><span class="s2">&quot;Choose a record&quot;</span><span class="p">,</span> <span class="nx">jobsTable</span><span class="p">);</span>
</code></pre></div>

<h3>1. Get all time entries for a particular job</h3>
<p>Airtable makes it easy to get all of the linked entries for a record by getting its cell value. This provides me with a list of each linked record as an object.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span> <span class="nx">linkedTimeEntries</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Time Entries&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
<span class="nx">output</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; total time entries&quot;</span><span class="p">);</span>
</code></pre></div>

<h3>2. Loop through all matching time entries</h3>
<p>Now that I have each linked time entry, I can loop through them and make sure I'm getting the correct info.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// loop over all time entries for record</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">timeEntriesQuery</span><span class="p">.</span><span class="nx">getRecord</span><span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">output</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>3. Check to make sure the time entry hasn't been invoiced</h3>
<p>While looping, I'll need to make sure that each time entry hasn't already been invoiced, If the boolean value of the "Invoiced" field is <code>false</code> then I'll output the date of the entry as a check.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// loop over all time entries for record</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">timeEntriesQuery</span><span class="p">.</span><span class="nx">getRecord</span><span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
    <span class="c1">// if time entry not invoiced</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Invoiced&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">output</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; not invoiced&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3>4. Mark it as invoiced</h3>
<p>If a time entry hasn't been "invoiced", I will check it off using the <a href="https://www.airtable.com/developers/scripting/api/table#update-record-async"><code>updateRecordAsync()</code></a> function.</p>
<div class="codehilite"><pre><span></span><code><span class="k">await</span> <span class="nx">timeEntriesTable</span><span class="p">.</span><span class="nx">updateRecordAsync</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">Invoiced</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

<h2>Putting It All Together</h2>
<p>Now that all of the steps I laid out above are covered, I can put everything together and give it a test run.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// get the two tables I need to work on</span>
<span class="kd">let</span> <span class="nx">jobsTable</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">getTable</span><span class="p">(</span><span class="s2">&quot;Jobs&quot;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">timeEntriesTable</span> <span class="o">=</span> <span class="nx">base</span><span class="p">.</span><span class="nx">getTable</span><span class="p">(</span><span class="s2">&quot;Time Entries&quot;</span><span class="p">);</span>
<span class="c1">// get all time entries for later reference</span>
<span class="kd">let</span> <span class="nx">timeEntriesQuery</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">timeEntriesTable</span><span class="p">.</span><span class="nx">selectRecordsAsync</span><span class="p">();</span>
<span class="c1">// when run via button, automatically use that record otherwise choose</span>
<span class="kd">let</span> <span class="nx">record</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">input</span><span class="p">.</span><span class="nx">recordAsync</span><span class="p">(</span><span class="s2">&quot;Choose a record&quot;</span><span class="p">,</span> <span class="nx">jobsTable</span><span class="p">);</span>
<span class="c1">// get all linked time entries for record</span>
<span class="kd">let</span> <span class="nx">linkedTimeEntries</span> <span class="o">=</span> <span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Time Entries&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">[];</span>
<span class="nx">output</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Found &quot;</span> <span class="o">+</span> <span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; total time entries&quot;</span><span class="p">);</span>
<span class="c1">// loop over all time entries for record</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">linkedTimeEntries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">timeEntriesQuery</span><span class="p">.</span><span class="nx">getRecord</span><span class="p">(</span><span class="nx">linkedTimeEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span>
    <span class="c1">// if time entry not invoiced</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Invoiced&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// check &quot;Invoiced&quot;</span>
      <span class="k">await</span> <span class="nx">timeEntriesTable</span><span class="p">.</span><span class="nx">updateRecordAsync</span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">Invoiced</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">});</span>
      <span class="nx">output</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;âœ… &quot;</span> <span class="o">+</span> <span class="nx">record</span><span class="p">.</span><span class="nx">getCellValue</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>If you are trying something similar, I would highly recommend using a copy of your production Airtable base, or at least make a test "job" with test "time entries".</p>
<p>So, here it is in action.</p>
<p><img alt="Airtable Checkbox Script in Action" loading="lazy" src="/static/images/airtable-checkbox-script.gif" /></p>
<p>As you can see, when I want to mark all time entries for a job as "invoiced" I just click the big blue button and the script goes to work. #satisfied</p>
<p><a href="https://gist.github.com/joshbduncan/10b7f448e984e238fdbfa3fc95ebc1e6">View the full script here</a></p>
  </div>
  <div id="post-tags">
    
    <ul id="tags">
      <li><b>Tags:</b></li>
      
      <li><a href="/tag/airtable.html">airtable</a>, </li>
      
      <li><a href="/tag/automation.html">automation</a>, </li>
      
      <li><a href="/tag/javascript.html">javascript</a></li>
      
    </ul>
    
  </div>
</article>

    </div>
  </section>

  <footer class="text-align-center">
    <p>&copy; 2021 Josh Duncan</p>
    <ul>
      <li>
        <a href="https://github.com/joshbduncan" target="_blank" class="text-decoration-none">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" />
          </svg>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/joshbduncan" target="_blank" class="text-decoration-none">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16">
            <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z" />
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.instagram.com/joshbduncan/" target="_blank" class="text-decoration-none">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
            <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z" />
          </svg>
        </a>
      </li>
    </ul>
  </footer>

  <script>
    // wink wink ðŸ˜‰
    function wink(e, action) {
      if (action === 1) { e.src = "/static/images/jbd_avatar_pixel_head_wink.svg"; }
      else { e.src = "/static/images/jbd_avatar_pixel_head.svg"; }
    }
  </script>

</body>

</html>