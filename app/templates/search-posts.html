<script>
    const searchInput = document.getElementById("search-input");
    const posts = Array.from(document.querySelectorAll("article"));

    searchInput.focus();
    searchInput.select();

    // build search index
    const index = posts.map((post) => {
        const title = post.querySelector(".post-title a")?.textContent?.trim() ?? "";
        const description = post.querySelector(".post-description")?.textContent?.trim() ?? "";
        const tags = post.getAttribute("data-post-tags")?.trim() ?? "";
        return (title + " " + description + " " + tags).toLowerCase();
    });

    const tokens = (q) =>
        q.toLowerCase().trim().split(/\s+/).filter(Boolean);

    const matches = (text, words) =>
        words.some((w) => text.includes(w));

    const searchPosts = () => {
        const words = tokens(searchInput.value);

        posts.forEach((post, i) => {
            const show = words.length > 0 && matches(index[i], words);
            post.classList.toggle("hidden", !show);
        });
    };

    searchInput.addEventListener("input", searchPosts);
    searchPosts();
</script>