{% extends "base.html" %}
{% block content %}

<article>
  <header>
    <div>
      <input data-search type="search" id="search" placeholder="Search posts, tags, and categories">
    </div>
  </header>
</article>

<ul id="posts" data-posts-list>
  <template data-post-template>
    <li class="hide">
      <article>
        <header>
          <h2><a class="text-decoration-none" data-title href=""></a></h2>
        </header>
        <p data-description></p>
      </article>
    </li>
  </template>
</ul>

<script>
  const postTemplate = document.querySelector("[data-post-template]");
  const postList = document.querySelector("[data-posts-list]");
  const searchInput = document.querySelector("[data-search]");

  searchInput.addEventListener("input", (e) => {
    const query = e.target.value.toLowerCase();
    const tokens = query.trim().split(" ");
    const matches = [];
    posts.forEach((post) => {
      let isVisible = false;
      tokens.forEach((word) => {
        let re = new RegExp("\\b" + word);
        if (
          re.test(post.body) ||
          re.test(post.title.toLowerCase()) ||
          re.test(post.description.toLowerCase()) ||
          re.test(post.tags.join(" ").toLowerCase())
        )
          isVisible = true;
      });
      post.element.classList.toggle("hide", query.length > 0 ? !isVisible : true);
    });
  });

  fetch("./posts.json")
    .then((response) => response.json())
    .then((data) => {
      posts = data.map((post) => {
        const li = postTemplate.content.cloneNode(true).children[0];
        const title = li.querySelector("[data-title]");
        const description = li.querySelector("[data-description]");
        title.textContent = post.title;
        title.href = post.url;
        description.textContent = post.description;
        postList.append(li);
        post["element"] = li;
        return post;
      });
    });
</script>

{% endblock content %}